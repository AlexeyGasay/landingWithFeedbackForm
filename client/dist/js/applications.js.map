{"version":3,"sources":["applications.js"],"names":["applicationsBlock","document","getElementById","applicationsInput","deleteBtn","applications","renderApplications","map","el","innerHTML","email","subject","fetchApplications","message","applicationDiv","value","_callee","regeneratorRuntime","wrap","_context","prev","next","e","target","fetch","concat","method","headers","Content-Type","then","res","json","data","console","applicationsList","forEach","element","getElementsByTagName","textContent","split","addEventListener","deleteApplication","stop","_callee2","_context2","alert","sent"],"mappings":"0YACA,IAAIA,kBAAoBC,SAASC,eAAe,sBAC5CC,kBAAoBF,SAASC,eAAe,sBAG5CE,UAAYH,SAASC,eAAe,2BAKpCG,aAAe,GAEnB,SAASC,qBAIPD,IAAAA,EAAiB,GAShBA,aATDE,IAAA,SAAAC,GAWAR,GAAkBS,gEAAAA,OAEnBD,EAAAE,MAFmBD,kCAAAA,OARID,EAAGG,QAQPF,+BAAAA,OAILG,EAAAA,KAJKH,kCAAAA,OANID,EAAGK,QAMPJ,0FAAlBT,kBAIFS,UAAAK,WACMC,uKADN,SAAAC,EACuBD,GADvB,IAAAA,EAAA,OAAAE,mBAAAC,KAAA,SAAAC,GAAA,OAAA,OAAAA,EAAAC,KAAAD,EAAAE,MAAA,KAAA,EAAA,OACMN,EADNO,EAAAC,OAAAR,MAAAI,EAAAE,KAAA,EAGQG,MAAK,mEAAAC,OAA6EV,GAAA,CACtFW,OAAQ,MACRC,QAAS,CACPC,eADO,sBAIRC,KAAM,SAAAC,GANH,OAOHD,EAAME,SAANF,KAAM,SAAAG,GACLC,QACA5B,IAAAA,GAAAA,aAZN2B,EAAAA,OAAA,KAAA,EAgBE1B,qBAIA4B,SAAiBC,iBAAQC,gBAEnB1B,QAAQ0B,SAAAA,GAAZ,IAAI1B,EAGJ0B,EAAUA,uBAAQC,SAAqB,GAAAC,YAAvCC,MAAA,KAAA,GAE8BH,EAA9BC,qBAAA,UAAA,GAAIG,iBAAiB,QAAS,WAAA,OAAKC,kBAAkB/B,OA3BzD,KAAA,EAAA,IAAA,MAAA,OAAAS,EAAAuB,SAAA1B,sCAAAyB,uKAiCA,SAAAE,EAjCAjC,GAiCA,OAAAO,mBAAAC,KAAA,SAAA0B,GAAA,OAAA,OAAAA,EAAAxB,KAAAwB,EAAAvB,MAAA,KAAA,EAAA,OAAAuB,EAAAvB,KAAA,EACoBG,MAAK,kEAAAC,OAAmEf,GAAS,CACjGgB,OAAQ,SACRC,QAAS,CACPC,eAAgB,sBAGnBC,KAAM,SAAAC,GAAG,OAAIA,EAAIC,SACjBF,KAAM,SAAAG,GACLa,MAAMb,KATV,KAAA,EAAAY,EAAAE,KAAA,KAAA,EAAA,IAAA,MAAA,OAAAF,EAAAF,SAAAC,6BAcAxC,kBAdAqC,iBAAA,QAAA5B","file":"applications.js","sourcesContent":["// Обработка заявок\r\nlet applicationsBlock = document.getElementById(\"applications_block\");\r\nlet applicationsInput = document.getElementById(\"applications_input\");\r\n\r\n\r\nlet deleteBtn = document.getElementById(\"application__delete_btn\");\r\n\r\n\r\n\r\n\r\nlet applications = [];\r\n\r\nfunction renderApplications() {\r\n  \r\n  let applicationDiv = ``;\r\n\r\n  applications.map(el => {\r\n      applicationDiv += `<div class=\"application\">\r\n        <div class=\"email\">Email: ${el.email}</div>\r\n        <div>Subject: ${el.subject}</div>\r\n        <div>Name: ${el.name}</div>\r\n        <div>Message: ${el.message}</div>\r\n\r\n        <button id=\"application__delete_btn\">DELETE</button>\r\n      </div>`\r\n  });\r\n\r\n  applicationsBlock.innerHTML = applicationDiv;\r\n\r\n}\r\n\r\nasync function fetchApplications(e) {\r\n  let value = e.target.value;\r\n\r\n  await fetch(`https://secret-taiga-20525.herokuapp.com/api/applications?email=${value}`, {\r\n    method: \"GET\",\r\n    headers: {\r\n      'Content-Type': 'application/json'\r\n    }\r\n  })\r\n    .then( res => res.json() )\r\n    .then( data => {\r\n      console.log(data);\r\n      applications = data.data\r\n    });\r\n  \r\n  // Отрисовка элементов\r\n  renderApplications()\r\n  \r\n  let applicationsList = document.querySelectorAll(\".application\");\r\n\r\n  applicationsList.forEach(element => {\r\n    // Найти в каждой заявке div.email, взять текст и разделить по пробелу\r\n    let email = element.getElementsByClassName(\"email\")[0].textContent.split(\" \")[1];\r\n    \r\n    // Кнопкка удалить\r\n    let btn = element.getElementsByTagName(\"button\")[0];\r\n    \r\n    btn.addEventListener(\"click\", ()=> deleteApplication(email))\r\n    \r\n  });\r\n\r\n}\r\n\r\nasync function deleteApplication(email) {\r\n  const res = await fetch(`https://secret-taiga-20525.herokuapp.com/api/application?email=${email}`, {\r\n    method: \"DELETE\",\r\n    headers: {\r\n      'Content-Type': 'application/json'\r\n    }\r\n  })\r\n  .then( res => res.json() )\r\n  .then( data => {\r\n    alert(data);\r\n  });\r\n\r\n}\r\n  \r\napplicationsInput.addEventListener(\"input\", fetchApplications)"]}